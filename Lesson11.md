# Assessment 4: Homework handbook lesson 11
***  

###  Lesson11

#### 1. Write a query that shows the salespeople's (SalesPersonID) average annual order amount (from the OrderDate column).
First process the data from the Order header table to get the total amount of orders generated by each salesperson in each year. Then calculate the average of the orders per salesperson for each year.
#### Instructions: (note all sections):

#### a. Define a CTE that includes the SalesPersonID, year and total orders generated for each year (OrderDate) and salesperson. Calculate only for order records that have a SalesPersonID.

---
* Q1-a Answer code

```SQL
SELECT SalesPersonID,
    YEAR(OrderDate) AS 'SaleYear',
    SUM(SubTotal) AS 'TotalYearOrders'
FROM AdventureWorks2016.Sales.SalesOrderHeader
WHERE SalesPersonID IS NOT NULL
GROUP BY SalesPersonID, YEAR(OrderDate);
```


---
#### b. Use the CTE you already defined to display the average amount of sellers' orders for each year.  
* Q1-b Answer code

```sql
WITH
    Q10a
    AS
    
    (
        SELECT SalesPersonID,
            YEAR(OrderDate) AS 'SaleYear',
            SUM(SubTotal) AS 'TotalYearOrders'
        FROM AdventureWorks2016.Sales.SalesOrderHeader
        WHERE SalesPersonID IS NOT NULL
        GROUP BY SalesPersonID, YEAR(OrderDate)
    )

SELECT SaleYear,
    AVG(TotalYearOrders) AS 'Yearly Average Orders Per SalesPerson' 
FROM Q10a
GROUP BY SaleYear
```

---
